-- Crear tabla plataforma

CREATE TABLE plataformas (
  id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(100) NOT NULL,
  descripcion VARCHAR(255) NULL,
  url VARCHAR(255) NULL,
  activo TINYINT(1) NOT NULL DEFAULT 1,
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY uq_plataformas_nombre (nombre)
) ENGINE=InnoDB;

-- INSERT plataforma, datos de prueba

INSERT INTO plataformas (nombre, descripcion, url)
VALUES
('Netflix', 'Streaming de series y películas', 'https://www.netflix.com'),
('Disney+', 'Contenido Disney, Marvel, Pixar', 'https://www.disneyplus.com'),
('Amazon Prime Video', 'Streaming de Amazon', 'https://www.primevideo.com');

-- Crear tabla directores

CREATE TABLE directores (
  id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(100) NOT NULL,
  apellidos VARCHAR(120) NOT NULL,
  fecha_nacimiento DATE NULL,
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB;

-- INSERT directores, datos de prueba

INSERT INTO directores (nombre, apellidos, fecha_nacimiento) VALUES
('Vince', 'Gilligan', '1967-02-10'),
('David', 'Benioff', '1970-09-25'),
('Shonda', 'Rhimes', '1970-01-13');

-- Crear tabla actores
CREATE TABLE actores (
  id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(100) NOT NULL,
  apellidos VARCHAR(120) NOT NULL,
  fecha_nacimiento DATE NULL,
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB;

-- INSERT actores, datos de prueba

INSERT INTO actores (nombre, apellidos, fecha_nacimiento) VALUES
('Bryan', 'Cranston', '1956-03-07'),
('Emilia', 'Clarke', '1986-10-23'),
('Millie Bobby', 'Brown', '2004-02-19');

-- Crear tabla idiomas

CREATE TABLE idiomas (
  id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(80) NOT NULL,
  codigo VARCHAR(10) NOT NULL,
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY uq_idiomas_codigo (codigo),
  UNIQUE KEY uq_idiomas_nombre (nombre)
) ENGINE=InnoDB;

-- INSERT idiomas, datos de prueba

INSERT INTO idiomas (nombre, codigo) VALUES
('Español', 'es'),
('Inglés', 'en'),
('Francés', 'fr');

-- Crear tabla series

CREATE TABLE series (
  id INT AUTO_INCREMENT PRIMARY KEY,
  titulo VARCHAR(150) NOT NULL,
  sinopsis TEXT NULL,
  anio INT NULL,
  temporadas INT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP
);

-- Tabla intermedia Serie_Plataforma

CREATE TABLE serie_plataforma (
  serie_id INT NOT NULL,
  plataforma_id INT UNSIGNED NOT NULL,
  PRIMARY KEY (serie_id, plataforma_id),
  CONSTRAINT fk_sp_serie
    FOREIGN KEY (serie_id) REFERENCES series(id) ON DELETE CASCADE,
  CONSTRAINT fk_sp_plataforma
    FOREIGN KEY (plataforma_id) REFERENCES plataformas(id) ON DELETE CASCADE
) ENGINE=InnoDB;

-- Tabla intermedia Serie_Actor

CREATE TABLE serie_actor (
  serie_id INT NOT NULL,
  actor_id INT UNSGINED NOT NULL,
  PRIMARY KEY (serie_id, actor_id),
  FOREIGN KEY (serie_id) REFERENCES series(id) ON DELETE CASCADE,
  FOREIGN KEY (actor_id) REFERENCES actores(id) ON DELETE CASCADE
);

-- Tabla intermedia Serie_Idioma_Audio

CREATE TABLE serie_idioma_audio (
  serie_id INT NOT NULL,
  idioma_id INT UNSIGNED NOT NULL,
  PRIMARY KEY (serie_id, idioma_id),
  FOREIGN KEY (serie_id) REFERENCES series(id) ON DELETE CASCADE,
  FOREIGN KEY (idioma_id) REFERENCES idiomas(id) ON DELETE CASCADE
);

-- Tabla intermedia Serie_Idioma_Subtitulos


CREATE TABLE serie_idioma_sub (
  serie_id INT NOT NULL,
  idioma_id INT UNSIGNED NOT NULL,
  PRIMARY KEY (serie_id, idioma_id),
  FOREIGN KEY (serie_id) REFERENCES series(id) ON DELETE CASCADE,
  FOREIGN KEY (idioma_id) REFERENCES idiomas(id) ON DELETE CASCADE
);

-- INSERT DATOS DE PRUEBA

-- SERIE

INSERT INTO series (titulo, sinopsis, anio, temporadas)
VALUES (
  'Breaking Bad',
  'Un profesor de química se convierte en fabricante de metanfetaminas',
  2008,
  5
);

-- SERIE_PLATAFORMA

INSERT INTO serie_plataforma (serie_id, plataforma_id)
VALUES (1, 1);

-- SERIE_ACTOR

INSERT INTO serie_actor (serie_id, actor_id)
VALUES (1, 1);

-- SERIE_IDIOMA_AUDIO

INSERT INTO serie_idioma_audio (serie_id, idioma_id)
VALUES (1, 1);

-- SERIE_IDIOMA_SUB

INSERT INTO serie_idioma_sub (serie_id, idioma_id)
VALUES (1, 2);


-- COMPROBAR 

SELECT s.titulo, p.nombre AS plataforma
FROM series s
JOIN serie_plataforma sp ON sp.serie_id = s.id
JOIN plataformas p ON p.id = sp.plataforma_id;



















